<p-panel header="Chỉnh sửa Dashboard KPI">
  <div class="split-horizontal-no-line"></div>
  <aw-kpi-info [kpiData]="kpiData"></aw-kpi-info>

  <h5 class="p-text-bold">Chỉnh sửa Dashboard KPI</h5>
  <aw-kpi-filter (filter)="doFilter($event)" [areaList]="areaList"></aw-kpi-filter>

  <p-table #tableKpi dataKey="id" [value]="kpiAreaList"
           [(selection)]="kpiAreaSelectedList"
           (selectionChange)="cboChange($event)"
           [paginator]="true"
           [rows]="10"
           [totalRecords]="kpiAreaList.length"
           [rowsPerPageOptions]="[10, 20, 50, 100]"
           [showCurrentPageReport]="true">
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 50px;">STT</th>
        <th>Các chỉ số</th>
        <th>Màu phân vùng dữ liệu</th>
        <th>
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          Cho phép hiển thị
        </th>
        <th>Thứ tự hiển thị</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item let-i="rowIndex">
      <tr>
        <td>{{i + 1}}</td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input style="width: 100%;" pInputText type="text" [(ngModel)]="item.value">
            </ng-template>
            <ng-template pTemplate="output">
              {{item.value}}
            </ng-template>
          </p-cellEditor>
        </td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-dropdown [autoDisplayFirst]="false" [style]="{'width':'100%'}" [options]="areaList" [(ngModel)]="item.area" optionLabel="name" dataKey="id">
                <ng-template let-area pTemplate="selectedItem">
                  <div class="p-d-flex p-align-center">
                    <i class="pi pi-circle-on" [ngStyle]="{'color': area.value.color}"></i>
                    <div class="p-ml-2">{{area.label}}</div>
                  </div>
                </ng-template>
                <ng-template let-area pTemplate="item">
                  <div class="p-d-flex p-align-center">
                    <i class="pi pi-circle-on" [ngStyle]="{'color': area.value.color}"></i>
                    <div class="p-ml-2">{{area.label}}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </ng-template>
            <ng-template pTemplate="output">
              <ng-container *ngIf="item.area.id else notArea">
                <i class="pi pi-circle-on" [ngStyle]="{'color': item.area?.color}"></i>
                {{item.area?.name}}
              </ng-container>
              <ng-template #notArea>
                Chọn vùng dữ liệu
              </ng-template>
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-tableCheckbox [value]="item"></p-tableCheckbox>
        </td>
        <td pEditableColumn>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input style="width: 100%;" pInputText type="number" [(ngModel)]="item.displayOrder">
            </ng-template>
            <ng-template pTemplate="output">
              {{item.displayOrder}}
            </ng-template>
          </p-cellEditor>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="p-text-right p-mt-3">
    <button (click)="doSave()" pButton label="Quay lại" icon="pi pi-arrow-left" class="p-button-secondary"></button>&nbsp;
    <button (click)="doSave()" pButton label="Lưu kết quả"></button>
  </div>
</p-panel>
<p-toast key="kpi-update-msg"></p-toast>
