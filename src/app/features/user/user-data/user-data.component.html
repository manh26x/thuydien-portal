<p-panel header="{{'list' | translate}}">
  <ng-template pTemplate="icons">
    <button class="p-panel-header-icon p-link" (click)="refreshSearch()" pTooltip="{{'btn.refresh' | translate}}" tooltipPosition="bottom">
      <i class="pi pi-refresh"></i>
    </button>
  </ng-template>
  <form class="p-grid p-fluid p-mb-3" [formGroup]="searchForm">
    <div class="p-lg-6 p-col-6 p-field">
      <label for="s-value">{{'user.fullName' | translate}}, {{'user.position' | translate}}</label>
      <input type="text" id="s-value" formControlName="keySearch" pInputText placeholder="{{'search' | translate}}" />
    </div>
    <div class="p-lg-2 p-col-6 p-field">
      <label>{{'user.role' | translate}}</label>
      <p-dropdown [options]="roleList" optionLabel="name" dataKey="code" formControlName="role"></p-dropdown>
    </div>
    <div class="p-lg-2 p-col-6 p-field">
      <label>{{'user.status' | translate}}</label>
      <p-dropdown [options]="statusList" optionLabel="name" dataKey="code" formControlName="status"></p-dropdown>
    </div>
    <div class="p-md-2 p-col-6 p-field p-d-flex p-align-end">
      <button (click)="getUserList()" pButton type="button" label="{{'filter' | translate}}" class="p-button-secondary" style="height: 46px"></button>
    </div>
  </form>
  <p-table
    [paginator]="true"
    [rows]="10"
    [totalRecords]="userList.length"
    [rowsPerPageOptions]="[10, 20, 50, 100]"
    [showCurrentPageReport]="true"
    sortField="user.fullName"
    [sortOrder]="-1"
    currentPageReportTemplate="{{ 'paging' | translate }}"
    [value]="userList">
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 50px;">{{'no' | translate}}</th>
        <th pSortableColumn="user.fullName">{{'user.fullName' | translate}}<p-sortIcon field="user.fullName"></p-sortIcon></th>
        <th pSortableColumn="user.userId">{{'user.userName' | translate}}<p-sortIcon field="user.userId"></p-sortIcon></th>
        <th pSortableColumn="user.role">{{'user.role' | translate}}<p-sortIcon field="user.role"></p-sortIcon></th>
        <th>{{'user.position' | translate}}</th>
        <th>{{'user.branch' | translate}}</th>
        <th pSortableColumn="user.status">{{'user.status' | translate}}<p-sortIcon field="user.status"></p-sortIcon></th>
        <th>
          <button *ngIf="userLogged.isSupperAdmin" (click)="gotoCreate()" pButton type="button" label="{{'btn.create' | translate}}" icon="pi pi-plus" class="p-button-secondary p-button-outlined"></button>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user let-index="rowIndex">
      <tr>
        <td>{{index + 1}}</td>
        <td>{{user.user.fullName}}</td>
        <td>{{user.user.userName}}</td>
        <td class="text-primary">
          <ng-container [ngSwitch]="user.user.role">
            <ng-container *ngSwitchCase="userConst.SUPPER_ADMIN">
              {{user.user.role}} <i class="pi pi-star supper-admin"></i>
            </ng-container>
            <ng-container *ngSwitchDefault>
              {{user.user.role}}
            </ng-container>
          </ng-container>
        </td>
        <td>{{user.user.position}}</td>
        <td>
          <div *ngFor="let item of user.listBranch;index as i" [ngClass]="{'p-mt-2': i != 0}">
            <ng-container>{{item.branchName}}</ng-container>
          </div>
        </td>
        <td>
          <ng-container [ngSwitch]="user.user.status">
            <ng-container *ngSwitchCase="userConst.ACTIVE">{{'const.active' | translate}}</ng-container>
            <ng-container *ngSwitchCase="userConst.INACTIVE">{{'const.inactive' | translate}}</ng-container>
          </ng-container>
         </td>
        <td>
          <button (click)="gotoView(user.user.userName)" pButton type="button" icon="pi pi-eye" class="p-button-rounded p-button-text"></button>
          <button *ngIf="userLogged.isSupperAdmin || user.user.userName == userLogged.userName" (click)="gotoUpdate(user.user.userName)" pButton
                  type="button" icon="pi pi-pencil" class="p-button-rounded p-button-secondary p-button-text">
          </button>
          <button (click)="doDelete(user)" pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text"></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="8">
          {{'noData' | translate}}
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-panel>
