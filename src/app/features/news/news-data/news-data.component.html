<p-panel header="{{'list' | translate}}">
  <ng-template pTemplate="icons">
    <button class="p-panel-header-icon p-link" (click)="refreshSearch()" pTooltip="{{'btn.refresh' | translate}}" tooltipPosition="bottom">
      <i class="pi pi-refresh"></i>
    </button>
  </ng-template>
  <form class="p-grid p-fluid p-mb-3" [formGroup]="formFilter">
    <div class="p-md-3 p-col-6 p-field">
      <label for="s-value">{{'news.name' | translate}}</label>
      <input type="text" id="s-value" (keyup.enter)="getListNews()" pInputText placeholder="{{'search' | translate}}" formControlName="searchValue" />
    </div>

    <div class="p-md-3 p-col-6 p-field">
      <label>{{'news.tags' | translate}}</label>
      <p-multiSelect formControlName="tags" [options]="tagsList" optionLabel="value" dataKey="id"></p-multiSelect>
    </div>
    <div class="p-md-2 p-col-6 p-field">
      <label>{{'news.status' | translate}}</label>
      <p-dropdown formControlName="status" [options]="statusList"></p-dropdown>
    </div>
    <div class="p-md-2 p-col-6 p-field">
      <label>{{'news.level' | translate}}</label>
      <p-dropdown formControlName="level" [options]="levelList"></p-dropdown>
    </div>
    <div class="p-md-2 p-col-12 p-field p-d-flex p-align-end">
      <button (click)="getListNews()" pButton type="button" label="{{'filter' | translate}}" class="p-button-secondary" style="height: 46px"></button>
    </div>
  </form>
  <p-table [value]="newsList" dataKey="id" styleClass="table-responsive"
           [customSort]="true"
           [autoLayout]="true"
           [lazy]="true"
           sortField="pubDate"
           [sortOrder]="-1"
           (onLazyLoad)="lazyLoadNews($event)">
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 50px;">{{'no' | translate}}</th>
        <th style="width: 70px;" pSortableColumn="id">{{'news.id' | translate}} <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="title" style="width: 350px;">{{'news.name' | translate}} <p-sortIcon field="title"></p-sortIcon></th>
        <th pSortableColumn="status">{{'news.status' | translate}} <p-sortIcon field="status"></p-sortIcon></th>
        <th pSortableColumn="pubDate">{{'news.publishDate' | translate}} <p-sortIcon field="pubDate"></p-sortIcon></th>
        <th pSortableColumn="publisher">{{'news.author' | translate}} <p-sortIcon field="publisher"></p-sortIcon></th>
        <th style="width: 150px;">{{'news.tags' | translate}}</th>
        <th pSortableColumn="priority">{{'news.level' | translate}} <p-sortIcon field="priority"></p-sortIcon></th>
        <th>
          <button *ngIf="isHasInsert" pButton type="button" label="{{'btn.insert' | translate}}" icon="pi pi-plus" class="p-button-secondary p-button-outlined" (click)="gotoCreate()"></button>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-news let-index="rowIndex">
      <tr>
        <td>{{(page * pageSize) + 1 + index}}</td>
        <td>{{news.id}}</td>
        <td>{{news.title}}</td>
        <td>
          <ng-container [ngSwitch]="news.status">
            <ng-container *ngSwitchCase="newsConst.STATUS_PUBLISHED">
              <div class="text-primary">{{'const.publish' | translate}}</div>
            </ng-container>
            <ng-container *ngSwitchCase="newsConst.STATUS_PENDING_PUBLISH">
              <div class="text-primary in-active">{{'const.pending' | translate}}</div>
            </ng-container>
            <ng-container *ngSwitchCase="newsConst.STATUS_DRAFT">
              <div>{{'const.draft' | translate}}</div>
            </ng-container>
            <ng-container *ngSwitchCase="newsConst.STATUS_DELETED">
              <div class="p-invalid">{{'const.delete' | translate}}</div>
            </ng-container>
            <ng-container *ngSwitchDefault>-</ng-container>
          </ng-container>
        </td>
        <td>{{news.publishTime | date: 'dd/MM/yyyy HH:mm'}}</td>
        <td>{{news.publisher}}</td>
        <td>
          <div *ngFor="let item of news.tagList | slice:0:news.maxShowTag;index as i" [ngClass]="{'p-mt-2': i != 0}">
            <ng-container>{{item.value}}</ng-container>
          </div>
          <div *ngIf="news.tagList?.length > initMaxShow" class="p-mt-1">
            <a *ngIf="news.maxShowTag != news.tagList.length; else showLess" (click)="news.maxShowTag = news.tagList.length" href="javascript:void('view more');">{{'viewMore' | translate}}</a>
            <ng-template #showLess><a (click)="news.maxShowTag = initMaxShow" href="javascript:void('view less');">{{'viewLess' | translate}}</a></ng-template>
          </div>
        </td>
        <td>
          <ng-container [ngSwitch]="news.priority">
            <ng-container *ngSwitchCase="newsConst.LEVEL_NORMAL">{{'const.levelNormal' | translate}}</ng-container>
            <ng-container *ngSwitchCase="newsConst.LEVEL_IMPORTANT">{{'const.levelImportant' | translate}}</ng-container>
            <ng-container *ngSwitchCase="newsConst.LEVEL_VERY_IMPORTANT">{{'const.levelVeryImportant' | translate}}</ng-container>
            <ng-container *ngSwitchDefault>-</ng-container>
          </ng-container>
        </td>
        <td>
          <button (click)="gotoView(news.id)" pButton type="button" icon="pi pi-eye" class="p-button-rounded p-button-text"></button>
          <button *ngIf="isHasEdit && news.status != newsConst.STATUS_DELETED" (click)="gotoUpdate(news.id)" pButton
                  type="button"
                  icon="pi pi-pencil"
                  class="p-button-rounded p-button-secondary p-button-text">
          </button>
          <button *ngIf="isHasDel && news.status != newsConst.STATUS_DELETED" (click)="doDelete(news)" pButton
                  type="button"
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-danger p-button-text">
          </button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="9">
          {{'noData' | translate}}
        </td>
      </tr>
    </ng-template>
  </p-table>
  <p-paginator [rows]="pageSize"
               [totalRecords]="totalItem"
               [rowsPerPageOptions]="[10, 20, 50, 100]"
               [showCurrentPageReport]="true"
               (onPageChange)="changePage($event)"
               currentPageReportTemplate="{{ 'paging' | translate }}">
  </p-paginator>
</p-panel>
