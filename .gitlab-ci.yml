variables:
  REGISTRY_NAMESPACE: "salesappv4"

image: ebit.tpb.vn/node:12-alpine

build:nodejs:
  stage: build
  only:
    - tpb-sit
  tags:
    - linux
    - builder
  before_script:
    - npm config set proxy http://$PROXY_USER:$PROXY_PASS@$PROXY_HOST:$PROXY_PORT
    - npm set strict-ssl false
  script:
    - npm install
    - npx ngcc --properties es2015 --create-ivy-entry-points
    - npm run ng build -- --configuration=docker
    - rm -rf /salesapp/portal/
    - mkdir -p /salesapp/portal
    - cp -R ./dist/sale-web-portal /salesapp/portal/sale-web-portal
    - cp nginx.conf /salesapp/portal/

build:docker:
  stage: build
  image: ebit.tpb.vn/docker:19.03.12
  before_script:
    - echo $REGISTRY_PASS | docker login $REGISTRY_HOST --username $REGISTRY_USER --password-stdin
  only:
    - tpb-sit
  tags:
    - linux
    - builder
    - docker
  script:
    - docker build -f Dockerfile_runner /salesapp/portal/

